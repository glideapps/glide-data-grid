import{r}from"./iframe-Iifyoimw.js";import{r as Q}from"./index-qADYP8W1.js";import{h as P,k as U,l as Z,T as ee,C as te,n as re}from"./data-editor-all-BqAFx8WH.js";import{s as ne}from"./marked.esm-B4q_PBrm.js";import"./throttle-BVHd-xO2.js";import"./flatten-Dm8ntmsO.js";const ie=()=>t=>t.targetX,se=()=>t=>t.targetY,ae=()=>t=>t.targetWidth,oe=()=>t=>t.targetHeight,de=()=>t=>t.targetY+10,le=()=>t=>Math.max(0,(t.targetHeight-28)/2),ce=ne("div")({name:"DataGridOverlayEditorStyle",class:"gdg-d19meir1",propsAsIs:!1,vars:{"d19meir1-0":[se(),"px"],"d19meir1-1":[ie(),"px"],"d19meir1-2":[ae(),"px"],"d19meir1-3":[oe(),"px"],"d19meir1-4":[de(),"px"],"d19meir1-5":[le(),"px"]}});function ue(){const[t,s]=r.useState();return[t??void 0,s]}function fe(){const[t,s]=ue(),[i,y]=r.useState(0),[m,k]=r.useState(!0);r.useLayoutEffect(()=>{if(t===void 0||!("IntersectionObserver"in window))return;const a=new IntersectionObserver(o=>{o.length!==0&&k(o[0].isIntersecting)},{threshold:1});return a.observe(t),()=>a.disconnect()},[t]),r.useEffect(()=>{if(m||t===void 0)return;let a;const o=()=>{const{right:R}=t.getBoundingClientRect();y(p=>Math.min(p+window.innerWidth-R-10,0)),a=requestAnimationFrame(o)};return a=requestAnimationFrame(o),()=>{a!==void 0&&cancelAnimationFrame(a)}},[t,m]);const S=r.useMemo(()=>({transform:`translateX(${i}px)`}),[i]);return{ref:s,style:S}}const be=t=>{const{target:s,content:i,onFinishEditing:y,forceEditMode:m,initialValue:k,imageEditorOverride:S,markdownDivCreateNode:a,highlight:o,className:R,theme:p,id:X,cell:h,bloom:u,portalElementRef:E,validateCell:d,getCellRenderer:T,provideEditor:b,isOutsideClick:A,customEventTarget:K}=t,[l,Y]=r.useState(m?i:void 0),D=r.useRef(l??i);D.current=l??i;const[v,I]=r.useState(()=>d===void 0?!0:!(P(i)&&(d==null?void 0:d(h,i,D.current))===!1)),f=r.useCallback((e,n)=>{y(v?e:void 0,n)},[v,y]),j=r.useCallback(e=>{if(d!==void 0&&e!==void 0&&P(e)){const n=d(h,e,D.current);n===!1?I(!1):(typeof n=="object"&&(e=n),I(!0))}Y(e)},[h,d]),C=r.useRef(!1),g=r.useRef(void 0),L=r.useCallback(()=>{f(l,[0,0]),C.current=!0},[l,f]),q=r.useCallback((e,n)=>{f(e,n??g.current??[0,0]),C.current=!0},[f]),B=r.useCallback(async e=>{let n=!1;switch(e.key){case"Escape":{e.stopPropagation(),e.preventDefault(),g.current=[0,0];break}case"Enter":{e.stopPropagation(),e.preventDefault(),g.current=[0,e.shiftKey?-1:1],n=!0;break}case"Tab":{e.stopPropagation(),e.preventDefault(),g.current=[e.shiftKey?-1:1,0],n=!0;break}}window.setTimeout(()=>{!C.current&&g.current!==void 0&&(f(n?l:void 0,g.current),C.current=!0)},0)},[f,l]),w=l??i,[c,$]=r.useMemo(()=>{var O,W;if(U(i))return[];const e={...i,location:h},n=b==null?void 0:b(e);return n!==void 0?[n,!1]:[(W=(O=T(i))==null?void 0:O.provideEditor)==null?void 0:W.call(O,e),!1]},[h,i,T,b]),{ref:z,style:J}=fe();let M=!0,_,N=!0,x;if(c!==void 0){M=c.disablePadding!==!0,N=c.disableStyling!==!0;const e=Z(c);e&&(x=c.styleOverride);const n=e?c.editor:c;_=r.createElement(n,{portalElementRef:E,isHighlighted:o,onChange:j,value:w,initialValue:k,onFinishedEditing:q,validatedSelection:P(w)?w.selectionRange:void 0,forceEditMode:m,target:s,imageEditorOverride:S,markdownDivCreateNode:a,isValid:v,theme:p})}x={...x,...J};const V=(E==null?void 0:E.current)??document.getElementById("portal");if(V===null)return console.error('Cannot open Data Grid overlay editor, because portal not found. Please, either provide a portalElementRef or add `<div id="portal" />` as the last child of your `<body>`.'),null;let F=N?"gdg-style":"gdg-unstyle";v||(F+=" gdg-invalid"),M&&(F+=" gdg-pad");const G=(u==null?void 0:u[0])??1,H=(u==null?void 0:u[1])??1;return Q.createPortal(r.createElement(ee.Provider,{value:p},r.createElement(te,{style:re(p),className:R,onClickOutside:L,isOutsideClick:A,customEventTarget:K},r.createElement(ce,{ref:z,id:X,className:F,style:x,as:$===!0?"label":void 0,targetX:s.x-G,targetY:s.y-H,targetWidth:s.width+G*2,targetHeight:s.height+H*2},r.createElement("div",{className:"gdg-clip-region",onKeyDown:B},_)))),V)};export{be as default};
