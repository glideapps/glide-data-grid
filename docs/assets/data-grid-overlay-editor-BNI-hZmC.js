import{r}from"./iframe-Cx8gvy1E.js";import{r as J}from"./index-CX8JGE1I.js";import{C as $}from"./data-editor-all-BgYYBmPH.js";import{H as F,v as Q,J as U,T as Z,O as ee}from"./image-window-loader-C9YYYyBz.js";import{s as te}from"./marked.esm-qCtXNNKQ.js";import"./throttle-kM8s9ilK.js";import"./flatten-DpASM6AF.js";import"./scrolling-data-grid-CikSAkxI.js";const re=()=>t=>t.targetX,se=()=>t=>t.targetY,ie=()=>t=>t.targetWidth,ne=()=>t=>t.targetHeight,oe=()=>t=>t.targetY+10,ae=()=>t=>Math.max(0,(t.targetHeight-28)/2),le=te("div")({name:"DataGridOverlayEditorStyle",class:"d16c1ze1",propsAsIs:!1,vars:{"d16c1ze1-0":[se(),"px"],"d16c1ze1-1":[re(),"px"],"d16c1ze1-2":[ie(),"px"],"d16c1ze1-3":[ne(),"px"],"d16c1ze1-4":[oe(),"px"],"d16c1ze1-5":[ae(),"px"]}});function ce(){const[t,n]=r.useState();return[t??void 0,n]}function de(){const[t,n]=ce(),[i,y]=r.useState(0),[p,b]=r.useState(!0);r.useLayoutEffect(()=>{if(t===void 0||!("IntersectionObserver"in window))return;const o=new IntersectionObserver(a=>{a.length!==0&&b(a[0].isIntersecting)},{threshold:1});return o.observe(t),()=>o.disconnect()},[t]),r.useEffect(()=>{if(p||t===void 0)return;let o;const a=()=>{const{right:O}=t.getBoundingClientRect();y(m=>Math.min(m+window.innerWidth-O-10,0)),o=requestAnimationFrame(a)};return o=requestAnimationFrame(a),()=>{o!==void 0&&cancelAnimationFrame(o)}},[t,p]);const C=r.useMemo(()=>({transform:`translateX(${i}px)`}),[i]);return{ref:n,style:C}}const Ee=t=>{const{target:n,content:i,onFinishEditing:y,forceEditMode:p,initialValue:b,imageEditorOverride:C,markdownDivCreateNode:o,highlight:a,className:O,theme:m,id:X,cell:S,bloom:u,validateCell:l,getCellRenderer:P,provideEditor:h,isOutsideClick:A,customEventTarget:N}=t,[c,V]=r.useState(p?i:void 0),k=r.useRef(c??i);k.current=c??i;const[v,R]=r.useState(()=>l===void 0?!0:!(F(i)&&(l==null?void 0:l(S,i,k.current))===!1)),f=r.useCallback((e,s)=>{y(v?e:void 0,s)},[v,y]),W=r.useCallback(e=>{if(l!==void 0&&e!==void 0&&F(e)){const s=l(S,e,k.current);s===!1?R(!1):(typeof s=="object"&&(e=s),R(!0))}V(e)},[S,l]),E=r.useRef(!1),g=r.useRef(void 0),Y=r.useCallback(()=>{f(c,[0,0]),E.current=!0},[c,f]),j=r.useCallback((e,s)=>{f(e,s??g.current??[0,0]),E.current=!0},[f]),K=r.useCallback(async e=>{let s=!1;e.key==="Escape"?(e.stopPropagation(),e.preventDefault(),g.current=[0,0]):e.key==="Enter"&&!e.shiftKey?(e.stopPropagation(),e.preventDefault(),g.current=[0,1],s=!0):e.key==="Tab"&&(e.stopPropagation(),e.preventDefault(),g.current=[e.shiftKey?-1:1,0],s=!0),window.setTimeout(()=>{!E.current&&g.current!==void 0&&(f(s?c:void 0,g.current),E.current=!0)},0)},[f,c]),I=c??i,[d,q]=r.useMemo(()=>{var s,G;if(Q(i))return[];const e=h==null?void 0:h(i);return e!==void 0?[e,!1]:[(G=(s=P(i))==null?void 0:s.provideEditor)==null?void 0:G.call(s,i),!1]},[i,P,h]),{ref:B,style:L}=de();let w=!0,z,T=!0,x;if(d!==void 0){w=d.disablePadding!==!0,T=d.disableStyling!==!0;const e=U(d);e&&(x=d.styleOverride);const s=e?d.editor:d;z=r.createElement(s,{isHighlighted:a,onChange:W,value:I,initialValue:b,onFinishedEditing:j,validatedSelection:F(I)?I.selectionRange:void 0,forceEditMode:p,target:n,imageEditorOverride:C,markdownDivCreateNode:o,isValid:v,theme:m})}x={...x,...L};const _=document.getElementById("portal");if(_===null)return console.error('Cannot open Data Grid overlay editor, because portal not found.  Please add `<div id="portal" />` as the last child of your `<body>`.'),null;let D=T?"gdg-style":"gdg-unstyle";v||(D+=" gdg-invalid"),w&&(D+=" gdg-pad");const H=(u==null?void 0:u[0])??1,M=(u==null?void 0:u[1])??1;return J.createPortal(r.createElement(Z.Provider,{value:m},r.createElement($,{style:ee(m),className:O,onClickOutside:Y,isOutsideClick:A,customEventTarget:N},r.createElement(le,{ref:B,id:X,className:D,style:x,as:q===!0?"label":void 0,targetX:n.x-H,targetY:n.y-M,targetWidth:n.width+H*2,targetHeight:n.height+M*2},r.createElement("div",{className:"gdg-clip-region",onKeyDown:K},z)))),_)};export{Ee as default};
