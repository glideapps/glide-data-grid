import{r as t}from"./iframe-DWzfc3gX.js";import{m as ve}from"./throttle-C5XnnlBK.js";import{Q as me,R as ge,u as we}from"./image-window-loader-CKe9ZaHy.js";import{s as Ce}from"./marked.esm-CCjIYZih.js";function ae(e,h,g,o){return ve(Math.round(h-(e.growOffset??0)),Math.ceil(g),Math.floor(o))}const Re=e=>{const[h,g]=t.useState(),[o,H]=t.useState(),[l,Y]=t.useState(),[a,v]=t.useState(),[R,M]=t.useState(!1),[G,c]=t.useState(),[S,W]=t.useState(),[N,re]=t.useState(),[q,$]=t.useState(!1),[B,p]=t.useState(),{onHeaderMenuClick:I,onHeaderIndicatorClick:z,getCellContent:ee,onColumnMoved:D,onColumnResize:x,onColumnResizeStart:A,onColumnResizeEnd:F,gridRef:_,maxColumnWidth:L,minColumnWidth:y,onRowMoved:K,lockColumns:X,onColumnProposeMove:O,onMouseDown:j,onMouseUp:te,onItemHovered:s,onDragStart:P,canvasRef:E,setScrollDir:U}=e,T=(x??F??A)!==void 0,{columns:m,selection:Q}=e,r=Q.columns,d=t.useCallback(n=>{const[u,C]=n.location;l!==void 0&&a!==u&&u>=X?(M(!0),v(u)):S!==void 0&&C!==void 0?($(!0),re(Math.max(0,C)),U(n.scrollEdge)):o===void 0&&!R&&!q&&(s==null||s(n))},[l,S,a,s,X,o,R,q,U]),b=D!==void 0,J=t.useCallback(n=>{var u;if(n.button===0){const[C,f]=n.location;if(n.kind==="out-of-bounds"&&n.isEdge&&T){const k=(u=_==null?void 0:_.current)==null?void 0:u.getBounds(m.length-1,-1);k!==void 0&&(g(k.x),H(m.length-1))}else if(n.kind==="header"&&C>=X){const k=E==null?void 0:E.current;if(n.isEdge&&T&&k){g(n.bounds.x),H(C);const ue=k.getBoundingClientRect().width/k.offsetWidth,ie=n.bounds.width/ue;A==null||A(m[C],ie,C,ie+(m[C].growOffset??0))}else n.kind==="header"&&b&&(c(n.bounds.x),Y(C))}else n.kind==="cell"&&X>0&&C===0&&f!==void 0&&K!==void 0&&(p(n.bounds.y),W(f))}j==null||j(n)},[j,T,X,K,_,m,b,A,E]),le=t.useCallback((n,u)=>{R||q||I==null||I(n,u)},[R,q,I]),ne=t.useCallback((n,u)=>{R||q||z==null||z(n,u)},[R,q,z]),i=t.useRef(-1),w=t.useCallback(()=>{i.current=-1,W(void 0),re(void 0),p(void 0),$(!1),Y(void 0),v(void 0),c(void 0),M(!1),H(void 0),g(void 0)},[]),V=t.useCallback((n,u)=>{if(n.button===0){if(o!==void 0){if((r==null?void 0:r.hasIndex(o))===!0)for(const f of r){if(f===o)continue;const k=m[f],Z=ae(k,i.current,y,L);x==null||x(k,Z,f,Z+(k.growOffset??0))}const C=ae(m[o],i.current,y,L);if(F==null||F(m[o],C,o,C+(m[o].growOffset??0)),r.hasIndex(o))for(const f of r){if(f===o)continue;const k=m[f],Z=ae(k,i.current,y,L);F==null||F(k,Z,f,Z+(k.growOffset??0))}}w(),l!==void 0&&a!==void 0&&(O==null?void 0:O(l,a))!==!1&&(D==null||D(l,a)),S!==void 0&&N!==void 0&&(K==null||K(S,N))}te==null||te(n,u)},[te,o,l,a,S,N,r,F,m,y,L,x,D,K,w,O]),oe=t.useMemo(()=>{if(!(l===void 0||a===void 0)&&l!==a&&(O==null?void 0:O(l,a))!==!1)return{src:l,dest:a}},[l,a,O]),se=t.useCallback(n=>{const u=E==null?void 0:E.current;if(l!==void 0&&G!==void 0)Math.abs(n.clientX-G)>20&&M(!0);else if(S!==void 0&&B!==void 0)Math.abs(n.clientY-B)>20&&$(!0);else if(o!==void 0&&h!==void 0&&u){const f=u.getBoundingClientRect().width/u.offsetWidth,k=(n.clientX-h)/f,Z=m[o],ue=ae(Z,k,y,L);if(x==null||x(Z,ue,o,ue+(Z.growOffset??0)),i.current=k,(r==null?void 0:r.first())===o)for(const ie of r){if(ie===o)continue;const fe=m[ie],he=ae(fe,i.current,y,L);x==null||x(fe,he,ie,he+(fe.growOffset??0))}}},[l,G,S,B,o,h,m,y,L,x,r,E]),de=t.useCallback((n,u)=>{if(S===void 0||N===void 0)return ee(n,u);let[C,f]=n;return f===N?f=S:(f>N&&(f-=1),f>=S&&(f+=1)),ee([C,f],u)},[S,N,ee]),ce=t.useCallback(n=>{P==null||P(n),n.defaultPrevented()||w()},[w,P]);return t.createElement(me,{accessibilityHeight:e.accessibilityHeight,canvasRef:e.canvasRef,cellXOffset:e.cellXOffset,cellYOffset:e.cellYOffset,columns:e.columns,disabledRows:e.disabledRows,drawFocusRing:e.drawFocusRing,drawHeader:e.drawHeader,drawCell:e.drawCell,enableGroups:e.enableGroups,eventTargetRef:e.eventTargetRef,experimental:e.experimental,fillHandle:e.fillHandle,firstColAccessible:e.firstColAccessible,fixedShadowX:e.fixedShadowX,fixedShadowY:e.fixedShadowY,freezeColumns:e.freezeColumns,getCellRenderer:e.getCellRenderer,getGroupDetails:e.getGroupDetails,getRowThemeOverride:e.getRowThemeOverride,groupHeaderHeight:e.groupHeaderHeight,headerHeight:e.headerHeight,headerIcons:e.headerIcons,height:e.height,highlightRegions:e.highlightRegions,imageWindowLoader:e.imageWindowLoader,resizeColumn:o,isDraggable:e.isDraggable,isFilling:e.isFilling,isFocused:e.isFocused,onCanvasBlur:e.onCanvasBlur,onCanvasFocused:e.onCanvasFocused,onCellFocused:e.onCellFocused,onContextMenu:e.onContextMenu,onDragEnd:e.onDragEnd,onDragLeave:e.onDragLeave,onDragOverCell:e.onDragOverCell,onDrop:e.onDrop,onKeyDown:e.onKeyDown,onKeyUp:e.onKeyUp,onMouseMove:e.onMouseMove,prelightCells:e.prelightCells,rowHeight:e.rowHeight,rows:e.rows,selection:e.selection,smoothScrollX:e.smoothScrollX,smoothScrollY:e.smoothScrollY,theme:e.theme,freezeTrailingRows:e.freezeTrailingRows,hasAppendRow:e.hasAppendRow,translateX:e.translateX,translateY:e.translateY,resizeIndicator:e.resizeIndicator,verticalBorder:e.verticalBorder,width:e.width,getCellContent:de,isResizing:o!==void 0,onHeaderMenuClick:le,onHeaderIndicatorClick:ne,isDragging:R,onItemHovered:d,onDragStart:ce,onMouseDown:J,allowResize:T,onMouseUp:V,dragAndDropState:oe,onMouseMoveRaw:se,ref:_})};function Se(e){const h=t.useRef(null),[g,o]=t.useState({width:e==null?void 0:e[0],height:e==null?void 0:e[1]});return t.useLayoutEffect(()=>{const H=Y=>{for(const a of Y){const{width:v,height:R}=a&&a.contentRect||{};o(M=>M.width===v&&M.height===R?M:{width:v,height:R})}},l=new window.ResizeObserver(H);return h.current&&l.observe(h.current,void 0),()=>{l.disconnect()}},[h.current]),{ref:h,...g}}const De=(e,h,g)=>{const o=t.useRef(null),H=t.useRef(null),l=t.useRef(null),Y=t.useRef(0),a=t.useRef(h);a.current=h;const v=g.current;t.useEffect(()=>{const R=()=>{var c,S;if(H.current===!1&&v!==null){const W=[v.scrollLeft,v.scrollTop];if(((c=l.current)==null?void 0:c[0])===W[0]&&((S=l.current)==null?void 0:S[1])===W[1])if(Y.current>10){l.current=null,H.current=null;return}else Y.current++;else Y.current=0,a.current(W[0],W[1]),l.current=W;o.current=window.setTimeout(R,8.333333333333334)}},M=()=>{H.current=!0,l.current=null,o.current!==null&&(window.clearTimeout(o.current),o.current=null)},G=c=>{c.touches.length===0&&(H.current=!1,Y.current=0,o.current=window.setTimeout(R,8.333333333333334))};if(e&&v!==null){const c=v;return c.addEventListener("touchstart",M),c.addEventListener("touchend",G),()=>{c.removeEventListener("touchstart",M),c.removeEventListener("touchend",G),o.current!==null&&window.clearTimeout(o.current)}}},[e,v])},be=()=>e=>e.isSafari?"scroll":"auto",He=Ce("div")({name:"ScrollRegionStyle",class:"sj2f20c",propsAsIs:!1,vars:{"sj2f20c-0":[be()]}}),Me=33554400,ye=5e6;function xe(e){const[h,g]=t.useState(!1),o=typeof window>"u"?null:window,H=t.useRef(0);return we("touchstart",t.useCallback(()=>{window.clearTimeout(H.current),g(!0)},[]),o,!0,!1),we("touchend",t.useCallback(l=>{l.touches.length===0&&(H.current=window.setTimeout(()=>g(!1),e))},[e]),o,!0,!1),h}const ke=e=>{var m,Q;const{children:h,clientHeight:g,scrollHeight:o,scrollWidth:H,update:l,draggable:Y,className:a,preventDiagonalScrolling:v=!1,paddingBottom:R=0,paddingRight:M=0,rightElement:G,rightElementProps:c,kineticScrollPerfHack:S=!1,scrollRef:W,initialSize:N}=e,re=[],q=(c==null?void 0:c.sticky)??!1,$=(c==null?void 0:c.fill)??!1,B=t.useRef(0),p=t.useRef(0),I=t.useRef(null),z=typeof window>"u"?1:window.devicePixelRatio,ee=t.useRef(z);t.useEffect(()=>{if(ee.current!==z){B.current=0,p.current=0,ee.current=z;const r=I.current;r!==null&&K.current(r.scrollLeft,r.scrollTop)}},[z]);const D=t.useRef({scrollLeft:0,scrollTop:0,lockDirection:void 0}),x=t.useRef(null),A=xe(200),[F,_]=t.useState(!0),L=t.useRef(0);t.useLayoutEffect(()=>{if(!F||A||D.current.lockDirection===void 0)return;const r=I.current;if(r===null)return;const[d,b]=D.current.lockDirection;d!==void 0?r.scrollLeft=d:b!==void 0&&(r.scrollTop=b),D.current.lockDirection=void 0},[A,F]);const y=t.useCallback((r,d)=>{var u;const b=I.current;if(b===null)return;d=d??b.scrollTop,r=r??b.scrollLeft;const J=D.current.scrollTop,le=D.current.scrollLeft,ne=r-le,i=d-J;A&&ne!==0&&i!==0&&(Math.abs(ne)>3||Math.abs(i)>3)&&v&&D.current.lockDirection===void 0&&(D.current.lockDirection=Math.abs(ne)<Math.abs(i)?[le,void 0]:[void 0,J]);const w=D.current.lockDirection;r=(w==null?void 0:w[0])??r,d=(w==null?void 0:w[1])??d,D.current.scrollLeft=r,D.current.scrollTop=d;const V=b.clientWidth,oe=b.clientHeight,se=d,de=p.current-se,ce=b.scrollHeight-oe;p.current=se;let n;if(ce>0&&o>b.scrollHeight+5)if(Math.abs(de)>2e3||se===0||se===ce){const C=Math.max(0,Math.min(1,se/ce)),f=o-oe;n=C*f,B.current=n}else B.current-=de,n=B.current;else n=se,B.current=n;n=Math.max(0,Math.min(n,o-oe)),B.current=n,w!==void 0&&(window.clearTimeout(L.current),_(!1),L.current=window.setTimeout(()=>_(!0),200)),l({x:r,y:n,width:V-M,height:oe-R,paddingRight:((u=x.current)==null?void 0:u.clientWidth)??0})},[R,M,o,l,v,A]);De(S&&ge.value,y,I);const K=t.useRef(y);K.current=y;const X=t.useRef(),O=t.useRef(!1);t.useLayoutEffect(()=>{O.current?y():O.current=!0},[y,R,M]);const j=t.useCallback(r=>{I.current=r,W!==void 0&&(W.current=r)},[W]);let te=0,s=0;const P=Math.min(o,Me);for(re.push(t.createElement("div",{key:te++,style:{width:H,height:0}}));s<P;){const r=Math.min(ye,P-s);re.push(t.createElement("div",{key:te++,style:{width:0,height:r}})),s+=r}const{ref:E,width:U,height:T}=Se(N);return typeof window<"u"&&(((m=X.current)==null?void 0:m.height)!==T||((Q=X.current)==null?void 0:Q.width)!==U)&&(window.setTimeout(()=>K.current(),0),X.current={width:U,height:T}),(U??0)===0||(T??0)===0?t.createElement("div",{ref:E}):t.createElement("div",{ref:E},t.createElement(He,{isSafari:ge.value},t.createElement("div",{className:"dvn-underlay"},h),t.createElement("div",{ref:j,style:X.current,draggable:Y,onDragStart:r=>{Y||(r.stopPropagation(),r.preventDefault())},className:"dvn-scroller "+(a??""),onScroll:()=>y()},t.createElement("div",{className:"dvn-scroll-inner"+(G===void 0?" dvn-hidden":"")},t.createElement("div",{className:"dvn-stack"},re),G!==void 0&&t.createElement(t.Fragment,null,!$&&t.createElement("div",{className:"dvn-spacer"}),t.createElement("div",{ref:x,style:{height:T,maxHeight:g-Math.ceil(z%1),position:"sticky",top:0,paddingLeft:1,marginBottom:-40,marginRight:M,flexGrow:$?1:void 0,right:q?M??0:void 0,pointerEvents:"auto"}},G))))))},Oe=e=>{const{columns:h,rows:g,rowHeight:o,headerHeight:H,groupHeaderHeight:l,enableGroups:Y,freezeColumns:a,experimental:v,nonGrowWidth:R,clientSize:M,className:G,onVisibleRegionChanged:c,scrollRef:S,preventDiagonalScrolling:W,rightElement:N,rightElementProps:re,overscrollX:q,overscrollY:$,initialSize:B,smoothScrollX:p=!1,smoothScrollY:I=!1,isDraggable:z}=e,{paddingRight:ee,paddingBottom:D}=v??{},[x,A]=M,F=t.useRef(),_=t.useRef(),L=t.useRef(),y=t.useRef(),K=R+Math.max(0,q??0);let X=Y?H+l:H;if(typeof o=="number")X+=g*o;else for(let s=0;s<g;s++)X+=o(s);$!==void 0&&(X+=$);const O=t.useRef(),j=t.useCallback(()=>{var le,ne;if(O.current===void 0)return;const s={...O.current};let P=0,E=s.x<0?-s.x:0,U=0,T=0;s.x=s.x<0?0:s.x;let m=0;for(let i=0;i<a;i++)m+=h[i].width;for(const i of h){const w=P-m;if(s.x>=w+i.width)P+=i.width,T++,U++;else if(s.x>w)P+=i.width,p?E+=w-s.x:T++,U++;else if(s.x+s.width>w)P+=i.width,U++;else break}let Q=0,r=0,d=0;if(typeof o=="number")I?(r=Math.floor(s.y/o),Q=r*o-s.y):r=Math.ceil(s.y/o),d=Math.ceil(s.height/o)+r,Q<0&&d++;else{let i=0;for(let w=0;w<g;w++){const V=o(w),oe=i+(I?0:V/2);if(s.y>=i+V)i+=V,r++,d++;else if(s.y>oe)i+=V,I?Q+=oe-s.y:r++,d++;else if(s.y+s.height>V/2+i)i+=V,d++;else break}}r=Math.max(0,Math.min(r,g-1)),d=Math.max(r,Math.min(d,g));const b={x:T,y:r,width:U-T,height:d-r},J=F.current;(J===void 0||J.y!==b.y||J.x!==b.x||J.height!==b.height||J.width!==b.width||_.current!==E||L.current!==Q||s.width!==((le=y.current)==null?void 0:le[0])||s.height!==((ne=y.current)==null?void 0:ne[1]))&&(c==null||c({x:T,y:r,width:U-T,height:d-r},s.width,s.height,s.paddingRight??0,E,Q),F.current=b,_.current=E,L.current=Q,y.current=[s.width,s.height])},[h,o,g,c,a,p,I]),te=t.useCallback(s=>{O.current=s,j()},[j]);return t.useEffect(()=>{j()},[j]),t.createElement(ke,{scrollRef:S,className:G,kineticScrollPerfHack:v==null?void 0:v.kineticScrollPerfHack,preventDiagonalScrolling:W,draggable:z===!0||typeof z=="string",scrollWidth:K+(ee??0),scrollHeight:X+(D??0),clientHeight:A,rightElement:N,paddingBottom:D,paddingRight:ee,rightElementProps:re,update:te,initialSize:B},t.createElement(Re,{eventTargetRef:S,width:x,height:A,accessibilityHeight:e.accessibilityHeight,canvasRef:e.canvasRef,cellXOffset:e.cellXOffset,cellYOffset:e.cellYOffset,columns:e.columns,disabledRows:e.disabledRows,enableGroups:e.enableGroups,fillHandle:e.fillHandle,firstColAccessible:e.firstColAccessible,fixedShadowX:e.fixedShadowX,fixedShadowY:e.fixedShadowY,freezeColumns:e.freezeColumns,getCellContent:e.getCellContent,getCellRenderer:e.getCellRenderer,getGroupDetails:e.getGroupDetails,getRowThemeOverride:e.getRowThemeOverride,groupHeaderHeight:e.groupHeaderHeight,headerHeight:e.headerHeight,highlightRegions:e.highlightRegions,imageWindowLoader:e.imageWindowLoader,isFilling:e.isFilling,isFocused:e.isFocused,lockColumns:e.lockColumns,maxColumnWidth:e.maxColumnWidth,minColumnWidth:e.minColumnWidth,onHeaderMenuClick:e.onHeaderMenuClick,onHeaderIndicatorClick:e.onHeaderIndicatorClick,onMouseMove:e.onMouseMove,prelightCells:e.prelightCells,rowHeight:e.rowHeight,rows:e.rows,selection:e.selection,theme:e.theme,freezeTrailingRows:e.freezeTrailingRows,hasAppendRow:e.hasAppendRow,translateX:e.translateX,translateY:e.translateY,onColumnProposeMove:e.onColumnProposeMove,verticalBorder:e.verticalBorder,drawFocusRing:e.drawFocusRing,drawHeader:e.drawHeader,drawCell:e.drawCell,experimental:e.experimental,gridRef:e.gridRef,headerIcons:e.headerIcons,isDraggable:e.isDraggable,onCanvasBlur:e.onCanvasBlur,onCanvasFocused:e.onCanvasFocused,onCellFocused:e.onCellFocused,onColumnMoved:e.onColumnMoved,onColumnResize:e.onColumnResize,onColumnResizeEnd:e.onColumnResizeEnd,onColumnResizeStart:e.onColumnResizeStart,onContextMenu:e.onContextMenu,onDragEnd:e.onDragEnd,onDragLeave:e.onDragLeave,onDragOverCell:e.onDragOverCell,onDragStart:e.onDragStart,onDrop:e.onDrop,onItemHovered:e.onItemHovered,onKeyDown:e.onKeyDown,onKeyUp:e.onKeyUp,onMouseDown:e.onMouseDown,onMouseUp:e.onMouseUp,onRowMoved:e.onRowMoved,smoothScrollX:e.smoothScrollX,smoothScrollY:e.smoothScrollY,resizeIndicator:e.resizeIndicator,setScrollDir:e.setScrollDir}))};export{Oe as G};
