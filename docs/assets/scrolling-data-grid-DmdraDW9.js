import{r as t}from"./iframe-DrAFbx-1.js";import{m as we}from"./throttle-DevZGRQD.js";import{Q as ve,R as he,u as ge}from"./image-window-loader-B_8mPMRZ.js";import{s as me}from"./marked.esm-BFtelUbM.js";function ce(e,w,v,o){return we(Math.round(w-(e.growOffset??0)),Math.ceil(v),Math.floor(o))}const Ce=e=>{const[w,v]=t.useState(),[o,H]=t.useState(),[l,Y]=t.useState(),[f,C]=t.useState(),[R,M]=t.useState(!1),[K,a]=t.useState(),[S,W]=t.useState(),[_,re]=t.useState(),[q,$]=t.useState(!1),[P,p]=t.useState(),{onHeaderMenuClick:I,onHeaderIndicatorClick:A,getCellContent:ee,onColumnMoved:D,onColumnResize:E,onColumnResizeStart:L,onColumnResizeEnd:F,gridRef:j,maxColumnWidth:G,minColumnWidth:y,onRowMoved:U,lockColumns:X,onColumnProposeMove:O,onMouseDown:Q,onMouseUp:te,onItemHovered:r,onDragStart:N,canvasRef:T}=e,z=(E??F??L)!==void 0,{columns:c,selection:se}=e,h=se.columns,n=t.useCallback(s=>{const[i,m]=s.location;l!==void 0&&f!==i&&i>=X?(M(!0),C(i)):S!==void 0&&m!==void 0?($(!0),re(Math.max(0,m))):o===void 0&&!R&&!q&&(r==null||r(s))},[l,S,f,r,X,o,R,q]),u=D!==void 0,x=t.useCallback(s=>{var i;if(s.button===0){const[m,g]=s.location;if(s.kind==="out-of-bounds"&&s.isEdge&&z){const b=(i=j==null?void 0:j.current)==null?void 0:i.getBounds(c.length-1,-1);b!==void 0&&(v(b.x),H(c.length-1))}else if(s.kind==="header"&&m>=X){const b=T==null?void 0:T.current;if(s.isEdge&&z&&b){v(s.bounds.x),H(m);const de=b.getBoundingClientRect().width/b.offsetWidth,ie=s.bounds.width/de;L==null||L(c[m],ie,m,ie+(c[m].growOffset??0))}else s.kind==="header"&&u&&(a(s.bounds.x),Y(m))}else s.kind==="cell"&&X>0&&m===0&&g!==void 0&&U!==void 0&&(p(s.bounds.y),W(g))}Q==null||Q(s)},[Q,z,X,U,j,c,u,L,T]),J=t.useCallback((s,i)=>{R||q||I==null||I(s,i)},[R,q,I]),le=t.useCallback((s,i)=>{R||q||A==null||A(s,i)},[R,q,A]),B=t.useRef(-1),d=t.useCallback(()=>{B.current=-1,W(void 0),re(void 0),p(void 0),$(!1),Y(void 0),C(void 0),a(void 0),M(!1),H(void 0),v(void 0)},[]),k=t.useCallback((s,i)=>{if(s.button===0){if(o!==void 0){if((h==null?void 0:h.hasIndex(o))===!0)for(const g of h){if(g===o)continue;const b=c[g],Z=ce(b,B.current,y,G);E==null||E(b,Z,g,Z+(b.growOffset??0))}const m=ce(c[o],B.current,y,G);if(F==null||F(c[o],m,o,m+(c[o].growOffset??0)),h.hasIndex(o))for(const g of h){if(g===o)continue;const b=c[g],Z=ce(b,B.current,y,G);F==null||F(b,Z,g,Z+(b.growOffset??0))}}d(),l!==void 0&&f!==void 0&&(O==null?void 0:O(l,f))!==!1&&(D==null||D(l,f)),S!==void 0&&_!==void 0&&(U==null||U(S,_))}te==null||te(s,i)},[te,o,l,f,S,_,h,F,c,y,G,E,D,U,d,O]),V=t.useMemo(()=>{if(!(l===void 0||f===void 0)&&l!==f&&(O==null?void 0:O(l,f))!==!1)return{src:l,dest:f}},[l,f,O]),oe=t.useCallback(s=>{const i=T==null?void 0:T.current;if(l!==void 0&&K!==void 0)Math.abs(s.clientX-K)>20&&M(!0);else if(S!==void 0&&P!==void 0)Math.abs(s.clientY-P)>20&&$(!0);else if(o!==void 0&&w!==void 0&&i){const g=i.getBoundingClientRect().width/i.offsetWidth,b=(s.clientX-w)/g,Z=c[o],de=ce(Z,b,y,G);if(E==null||E(Z,de,o,de+(Z.growOffset??0)),B.current=b,(h==null?void 0:h.first())===o)for(const ie of h){if(ie===o)continue;const ue=c[ie],fe=ce(ue,B.current,y,G);E==null||E(ue,fe,ie,fe+(ue.growOffset??0))}}},[l,K,S,P,o,w,c,y,G,E,h,T]),ne=t.useCallback((s,i)=>{if(S===void 0||_===void 0)return ee(s,i);let[m,g]=s;return g===_?g=S:(g>_&&(g-=1),g>=S&&(g+=1)),ee([m,g],i)},[S,_,ee]),ae=t.useCallback(s=>{N==null||N(s),s.defaultPrevented()||d()},[d,N]);return t.createElement(ve,{accessibilityHeight:e.accessibilityHeight,canvasRef:e.canvasRef,cellXOffset:e.cellXOffset,cellYOffset:e.cellYOffset,columns:e.columns,disabledRows:e.disabledRows,drawFocusRing:e.drawFocusRing,drawHeader:e.drawHeader,drawCell:e.drawCell,enableGroups:e.enableGroups,eventTargetRef:e.eventTargetRef,experimental:e.experimental,fillHandle:e.fillHandle,firstColAccessible:e.firstColAccessible,fixedShadowX:e.fixedShadowX,fixedShadowY:e.fixedShadowY,freezeColumns:e.freezeColumns,getCellRenderer:e.getCellRenderer,getGroupDetails:e.getGroupDetails,getRowThemeOverride:e.getRowThemeOverride,groupHeaderHeight:e.groupHeaderHeight,headerHeight:e.headerHeight,headerIcons:e.headerIcons,height:e.height,highlightRegions:e.highlightRegions,imageWindowLoader:e.imageWindowLoader,resizeColumn:o,isDraggable:e.isDraggable,isFilling:e.isFilling,isFocused:e.isFocused,onCanvasBlur:e.onCanvasBlur,onCanvasFocused:e.onCanvasFocused,onCellFocused:e.onCellFocused,onContextMenu:e.onContextMenu,onDragEnd:e.onDragEnd,onDragLeave:e.onDragLeave,onDragOverCell:e.onDragOverCell,onDrop:e.onDrop,onKeyDown:e.onKeyDown,onKeyUp:e.onKeyUp,onMouseMove:e.onMouseMove,prelightCells:e.prelightCells,rowHeight:e.rowHeight,rows:e.rows,selection:e.selection,smoothScrollX:e.smoothScrollX,smoothScrollY:e.smoothScrollY,theme:e.theme,freezeTrailingRows:e.freezeTrailingRows,hasAppendRow:e.hasAppendRow,translateX:e.translateX,translateY:e.translateY,resizeIndicator:e.resizeIndicator,verticalBorder:e.verticalBorder,width:e.width,getCellContent:ne,isResizing:o!==void 0,onHeaderMenuClick:J,onHeaderIndicatorClick:le,isDragging:R,onItemHovered:n,onDragStart:ae,onMouseDown:x,allowResize:z,onMouseUp:k,dragAndDropState:V,onMouseMoveRaw:oe,ref:j})};function Re(e){const w=t.useRef(null),[v,o]=t.useState({width:e==null?void 0:e[0],height:e==null?void 0:e[1]});return t.useLayoutEffect(()=>{const H=Y=>{for(const f of Y){const{width:C,height:R}=f&&f.contentRect||{};o(M=>M.width===C&&M.height===R?M:{width:C,height:R})}},l=new window.ResizeObserver(H);return w.current&&l.observe(w.current,void 0),()=>{l.disconnect()}},[w.current]),{ref:w,...v}}const Se=(e,w,v)=>{const o=t.useRef(null),H=t.useRef(null),l=t.useRef(null),Y=t.useRef(0),f=t.useRef(w);f.current=w;const C=v.current;t.useEffect(()=>{const R=()=>{var a,S;if(H.current===!1&&C!==null){const W=[C.scrollLeft,C.scrollTop];if(((a=l.current)==null?void 0:a[0])===W[0]&&((S=l.current)==null?void 0:S[1])===W[1])if(Y.current>10){l.current=null,H.current=null;return}else Y.current++;else Y.current=0,f.current(W[0],W[1]),l.current=W;o.current=window.setTimeout(R,8.333333333333334)}},M=()=>{H.current=!0,l.current=null,o.current!==null&&(window.clearTimeout(o.current),o.current=null)},K=a=>{a.touches.length===0&&(H.current=!1,Y.current=0,o.current=window.setTimeout(R,8.333333333333334))};if(e&&C!==null){const a=C;return a.addEventListener("touchstart",M),a.addEventListener("touchend",K),()=>{a.removeEventListener("touchstart",M),a.removeEventListener("touchend",K),o.current!==null&&window.clearTimeout(o.current)}}},[e,C])},De=()=>e=>e.isSafari?"scroll":"auto",be=me("div")({name:"ScrollRegionStyle",class:"sj2f20c",propsAsIs:!1,vars:{"sj2f20c-0":[De()]}}),He=33554400,Me=5e6;function ye(e){const[w,v]=t.useState(!1),o=typeof window>"u"?null:window,H=t.useRef(0);return ge("touchstart",t.useCallback(()=>{window.clearTimeout(H.current),v(!0)},[]),o,!0,!1),ge("touchend",t.useCallback(l=>{l.touches.length===0&&(H.current=window.setTimeout(()=>v(!1),e))},[e]),o,!0,!1),w}const xe=e=>{var se,h;const{children:w,clientHeight:v,scrollHeight:o,scrollWidth:H,update:l,draggable:Y,className:f,preventDiagonalScrolling:C=!1,paddingBottom:R=0,paddingRight:M=0,rightElement:K,rightElementProps:a,kineticScrollPerfHack:S=!1,scrollRef:W,initialSize:_}=e,re=[],q=(a==null?void 0:a.sticky)??!1,$=(a==null?void 0:a.fill)??!1,P=t.useRef(0),p=t.useRef(0),I=t.useRef(null),A=typeof window>"u"?1:window.devicePixelRatio,ee=t.useRef(A);t.useEffect(()=>{if(ee.current!==A){P.current=0,p.current=0,ee.current=A;const n=I.current;n!==null&&U.current(n.scrollLeft,n.scrollTop)}},[A]);const D=t.useRef({scrollLeft:0,scrollTop:0,lockDirection:void 0}),E=t.useRef(null),L=ye(200),[F,j]=t.useState(!0),G=t.useRef(0);t.useLayoutEffect(()=>{if(!F||L||D.current.lockDirection===void 0)return;const n=I.current;if(n===null)return;const[u,x]=D.current.lockDirection;u!==void 0?n.scrollLeft=u:x!==void 0&&(n.scrollTop=x),D.current.lockDirection=void 0},[L,F]);const y=t.useCallback((n,u)=>{var m;const x=I.current;if(x===null)return;u=u??x.scrollTop,n=n??x.scrollLeft;const J=D.current.scrollTop,le=D.current.scrollLeft,B=n-le,d=u-J;L&&B!==0&&d!==0&&(Math.abs(B)>3||Math.abs(d)>3)&&C&&D.current.lockDirection===void 0&&(D.current.lockDirection=Math.abs(B)<Math.abs(d)?[le,void 0]:[void 0,J]);const k=D.current.lockDirection;n=(k==null?void 0:k[0])??n,u=(k==null?void 0:k[1])??u,D.current.scrollLeft=n,D.current.scrollTop=u;const V=x.clientWidth,oe=x.clientHeight,ne=u,ae=p.current-ne,s=x.scrollHeight-oe;p.current=ne;let i;if(s>0&&o>x.scrollHeight+5)if(Math.abs(ae)>2e3||ne===0||ne===s){const g=Math.max(0,Math.min(1,ne/s)),b=o-oe;i=g*b,P.current=i}else P.current-=ae,i=P.current;else i=ne,P.current=i;i=Math.max(0,Math.min(i,o-oe)),P.current=i,k!==void 0&&(window.clearTimeout(G.current),j(!1),G.current=window.setTimeout(()=>j(!0),200)),l({x:n,y:i,width:V-M,height:oe-R,paddingRight:((m=E.current)==null?void 0:m.clientWidth)??0})},[R,M,o,l,C,L]);Se(S&&he.value,y,I);const U=t.useRef(y);U.current=y;const X=t.useRef(),O=t.useRef(!1);t.useLayoutEffect(()=>{O.current?y():O.current=!0},[y,R,M]);const Q=t.useCallback(n=>{I.current=n,W!==void 0&&(W.current=n)},[W]);let te=0,r=0;const N=Math.min(o,He);for(re.push(t.createElement("div",{key:te++,style:{width:H,height:0}}));r<N;){const n=Math.min(Me,N-r);re.push(t.createElement("div",{key:te++,style:{width:0,height:n}})),r+=n}const{ref:T,width:z,height:c}=Re(_);return typeof window<"u"&&(((se=X.current)==null?void 0:se.height)!==c||((h=X.current)==null?void 0:h.width)!==z)&&(window.setTimeout(()=>U.current(),0),X.current={width:z,height:c}),(z??0)===0||(c??0)===0?t.createElement("div",{ref:T}):t.createElement("div",{ref:T},t.createElement(be,{isSafari:he.value},t.createElement("div",{className:"dvn-underlay"},w),t.createElement("div",{ref:Q,style:X.current,draggable:Y,onDragStart:n=>{Y||(n.stopPropagation(),n.preventDefault())},className:"dvn-scroller "+(f??""),onScroll:()=>y()},t.createElement("div",{className:"dvn-scroll-inner"+(K===void 0?" dvn-hidden":"")},t.createElement("div",{className:"dvn-stack"},re),K!==void 0&&t.createElement(t.Fragment,null,!$&&t.createElement("div",{className:"dvn-spacer"}),t.createElement("div",{ref:E,style:{height:c,maxHeight:v-Math.ceil(A%1),position:"sticky",top:0,paddingLeft:1,marginBottom:-40,marginRight:M,flexGrow:$?1:void 0,right:q?M??0:void 0,pointerEvents:"auto"}},K))))))},Xe=e=>{const{columns:w,rows:v,rowHeight:o,headerHeight:H,groupHeaderHeight:l,enableGroups:Y,freezeColumns:f,experimental:C,nonGrowWidth:R,clientSize:M,className:K,onVisibleRegionChanged:a,scrollRef:S,preventDiagonalScrolling:W,rightElement:_,rightElementProps:re,overscrollX:q,overscrollY:$,initialSize:P,smoothScrollX:p=!1,smoothScrollY:I=!1,isDraggable:A}=e,{paddingRight:ee,paddingBottom:D}=C??{},[E,L]=M,F=t.useRef(),j=t.useRef(),G=t.useRef(),y=t.useRef(),U=R+Math.max(0,q??0);let X=Y?H+l:H;if(typeof o=="number")X+=v*o;else for(let r=0;r<v;r++)X+=o(r);$!==void 0&&(X+=$);const O=t.useRef(),Q=t.useCallback(()=>{var le,B;if(O.current===void 0)return;const r={...O.current};let N=0,T=r.x<0?-r.x:0,z=0,c=0;r.x=r.x<0?0:r.x;let se=0;for(let d=0;d<f;d++)se+=w[d].width;for(const d of w){const k=N-se;if(r.x>=k+d.width)N+=d.width,c++,z++;else if(r.x>k)N+=d.width,p?T+=k-r.x:c++,z++;else if(r.x+r.width>k)N+=d.width,z++;else break}let h=0,n=0,u=0;if(typeof o=="number")I?(n=Math.floor(r.y/o),h=n*o-r.y):n=Math.ceil(r.y/o),u=Math.ceil(r.height/o)+n,h<0&&u++;else{let d=0;for(let k=0;k<v;k++){const V=o(k),oe=d+(I?0:V/2);if(r.y>=d+V)d+=V,n++,u++;else if(r.y>oe)d+=V,I?h+=oe-r.y:n++,u++;else if(r.y+r.height>V/2+d)d+=V,u++;else break}}n=Math.max(0,Math.min(n,v-1)),u=Math.max(n,Math.min(u,v));const x={x:c,y:n,width:z-c,height:u-n},J=F.current;(J===void 0||J.y!==x.y||J.x!==x.x||J.height!==x.height||J.width!==x.width||j.current!==T||G.current!==h||r.width!==((le=y.current)==null?void 0:le[0])||r.height!==((B=y.current)==null?void 0:B[1]))&&(a==null||a({x:c,y:n,width:z-c,height:u-n},r.width,r.height,r.paddingRight??0,T,h),F.current=x,j.current=T,G.current=h,y.current=[r.width,r.height])},[w,o,v,a,f,p,I]),te=t.useCallback(r=>{O.current=r,Q()},[Q]);return t.useEffect(()=>{Q()},[Q]),t.createElement(xe,{scrollRef:S,className:K,kineticScrollPerfHack:C==null?void 0:C.kineticScrollPerfHack,preventDiagonalScrolling:W,draggable:A===!0||typeof A=="string",scrollWidth:U+(ee??0),scrollHeight:X+(D??0),clientHeight:L,rightElement:_,paddingBottom:D,paddingRight:ee,rightElementProps:re,update:te,initialSize:P},t.createElement(Ce,{eventTargetRef:S,width:E,height:L,accessibilityHeight:e.accessibilityHeight,canvasRef:e.canvasRef,cellXOffset:e.cellXOffset,cellYOffset:e.cellYOffset,columns:e.columns,disabledRows:e.disabledRows,enableGroups:e.enableGroups,fillHandle:e.fillHandle,firstColAccessible:e.firstColAccessible,fixedShadowX:e.fixedShadowX,fixedShadowY:e.fixedShadowY,freezeColumns:e.freezeColumns,getCellContent:e.getCellContent,getCellRenderer:e.getCellRenderer,getGroupDetails:e.getGroupDetails,getRowThemeOverride:e.getRowThemeOverride,groupHeaderHeight:e.groupHeaderHeight,headerHeight:e.headerHeight,highlightRegions:e.highlightRegions,imageWindowLoader:e.imageWindowLoader,isFilling:e.isFilling,isFocused:e.isFocused,lockColumns:e.lockColumns,maxColumnWidth:e.maxColumnWidth,minColumnWidth:e.minColumnWidth,onHeaderMenuClick:e.onHeaderMenuClick,onHeaderIndicatorClick:e.onHeaderIndicatorClick,onMouseMove:e.onMouseMove,prelightCells:e.prelightCells,rowHeight:e.rowHeight,rows:e.rows,selection:e.selection,theme:e.theme,freezeTrailingRows:e.freezeTrailingRows,hasAppendRow:e.hasAppendRow,translateX:e.translateX,translateY:e.translateY,onColumnProposeMove:e.onColumnProposeMove,verticalBorder:e.verticalBorder,drawFocusRing:e.drawFocusRing,drawHeader:e.drawHeader,drawCell:e.drawCell,experimental:e.experimental,gridRef:e.gridRef,headerIcons:e.headerIcons,isDraggable:e.isDraggable,onCanvasBlur:e.onCanvasBlur,onCanvasFocused:e.onCanvasFocused,onCellFocused:e.onCellFocused,onColumnMoved:e.onColumnMoved,onColumnResize:e.onColumnResize,onColumnResizeEnd:e.onColumnResizeEnd,onColumnResizeStart:e.onColumnResizeStart,onContextMenu:e.onContextMenu,onDragEnd:e.onDragEnd,onDragLeave:e.onDragLeave,onDragOverCell:e.onDragOverCell,onDragStart:e.onDragStart,onDrop:e.onDrop,onItemHovered:e.onItemHovered,onKeyDown:e.onKeyDown,onKeyUp:e.onKeyUp,onMouseDown:e.onMouseDown,onMouseUp:e.onMouseUp,onRowMoved:e.onRowMoved,smoothScrollX:e.smoothScrollX,smoothScrollY:e.smoothScrollY,resizeIndicator:e.resizeIndicator}))};export{Xe as G};
