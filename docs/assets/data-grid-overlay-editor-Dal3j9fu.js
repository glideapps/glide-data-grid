import{r}from"./iframe-Iifyoimw.js";import{r as Q}from"./index-qADYP8W1.js";import{C as U}from"./data-editor-all-CYJZRdiL.js";import{E as P,s as Z,F as ee,T as te,M as re}from"./image-window-loader-BDCXALa9.js";import{s as se}from"./marked.esm-B4q_PBrm.js";import"./throttle-BVHd-xO2.js";import"./flatten-Dm8ntmsO.js";import"./scrolling-data-grid-CX8tx08F.js";const ie=()=>t=>t.targetX,ne=()=>t=>t.targetY,ae=()=>t=>t.targetWidth,oe=()=>t=>t.targetHeight,ce=()=>t=>t.targetY+10,le=()=>t=>Math.max(0,(t.targetHeight-28)/2),de=se("div")({name:"DataGridOverlayEditorStyle",class:"d16c1ze1",propsAsIs:!1,vars:{"d16c1ze1-0":[ne(),"px"],"d16c1ze1-1":[ie(),"px"],"d16c1ze1-2":[ae(),"px"],"d16c1ze1-3":[oe(),"px"],"d16c1ze1-4":[ce(),"px"],"d16c1ze1-5":[le(),"px"]}});function ue(){const[t,n]=r.useState();return[t??void 0,n]}function fe(){const[t,n]=ue(),[i,v]=r.useState(0),[p,O]=r.useState(!0);r.useLayoutEffect(()=>{if(t===void 0||!("IntersectionObserver"in window))return;const a=new IntersectionObserver(o=>{o.length!==0&&O(o[0].isIntersecting)},{threshold:1});return a.observe(t),()=>a.disconnect()},[t]),r.useEffect(()=>{if(p||t===void 0)return;let a;const o=()=>{const{right:R}=t.getBoundingClientRect();v(m=>Math.min(m+window.innerWidth-R-10,0)),a=requestAnimationFrame(o)};return a=requestAnimationFrame(o),()=>{a!==void 0&&cancelAnimationFrame(a)}},[t,p]);const k=r.useMemo(()=>({transform:`translateX(${i}px)`}),[i]);return{ref:n,style:k}}const xe=t=>{const{target:n,content:i,onFinishEditing:v,forceEditMode:p,initialValue:O,imageEditorOverride:k,markdownDivCreateNode:a,highlight:o,className:R,theme:m,id:A,cell:h,bloom:u,portalElementRef:y,validateCell:c,getCellRenderer:z,provideEditor:E,isOutsideClick:N,customEventTarget:V}=t,[l,Y]=r.useState(p?i:void 0),I=r.useRef(l??i);I.current=l??i;const[b,D]=r.useState(()=>c===void 0?!0:!(P(i)&&(c==null?void 0:c(h,i,I.current))===!1)),f=r.useCallback((e,s)=>{v(b?e:void 0,s)},[b,v]),j=r.useCallback(e=>{if(c!==void 0&&e!==void 0&&P(e)){const s=c(h,e,I.current);s===!1?D(!1):(typeof s=="object"&&(e=s),D(!0))}Y(e)},[h,c]),x=r.useRef(!1),g=r.useRef(void 0),K=r.useCallback(()=>{f(l,[0,0]),x.current=!0},[l,f]),L=r.useCallback((e,s)=>{f(e,s??g.current??[0,0]),x.current=!0},[f]),q=r.useCallback(async e=>{let s=!1;switch(e.key){case"Escape":{e.stopPropagation(),e.preventDefault(),g.current=[0,0];break}case"Enter":{e.stopPropagation(),e.preventDefault(),g.current=[0,e.shiftKey?-1:1],s=!0;break}case"Tab":{e.stopPropagation(),e.preventDefault(),g.current=[e.shiftKey?-1:1,0],s=!0;break}}window.setTimeout(()=>{!x.current&&g.current!==void 0&&(f(s?l:void 0,g.current),x.current=!0)},0)},[f,l]),F=l??i,[d,B]=r.useMemo(()=>{var S,X;if(Z(i))return[];const e={...i,location:h},s=E==null?void 0:E(e);return s!==void 0?[s,!1]:[(X=(S=z(i))==null?void 0:S.provideEditor)==null?void 0:X.call(S,e),!1]},[h,i,z,E]),{ref:$,style:J}=fe();let M=!0,T,_=!0,C;if(d!==void 0){M=d.disablePadding!==!0,_=d.disableStyling!==!0;const e=ee(d);e&&(C=d.styleOverride);const s=e?d.editor:d;T=r.createElement(s,{portalElementRef:y,isHighlighted:o,onChange:j,value:F,initialValue:O,onFinishedEditing:L,validatedSelection:P(F)?F.selectionRange:void 0,forceEditMode:p,target:n,imageEditorOverride:k,markdownDivCreateNode:a,isValid:b,theme:m})}C={...C,...J};const G=(y==null?void 0:y.current)??document.getElementById("portal");if(G===null)return console.error('Cannot open Data Grid overlay editor, because portal not found. Please, either provide a portalElementRef or add `<div id="portal" />` as the last child of your `<body>`.'),null;let w=_?"gdg-style":"gdg-unstyle";b||(w+=" gdg-invalid"),M&&(w+=" gdg-pad");const H=(u==null?void 0:u[0])??1,W=(u==null?void 0:u[1])??1;return Q.createPortal(r.createElement(te.Provider,{value:m},r.createElement(U,{style:re(m),className:R,onClickOutside:K,isOutsideClick:N,customEventTarget:V},r.createElement(de,{ref:$,id:A,className:w,style:C,as:B===!0?"label":void 0,targetX:n.x-H,targetY:n.y-W,targetWidth:n.width+H*2,targetHeight:n.height+W*2},r.createElement("div",{className:"gdg-clip-region",onKeyDown:q},T)))),G)};export{xe as default};
