import{s as $,j as h}from"./marked.esm-dbrxtycE.js";import{r as i}from"./index-BMVQvedj.js";import{r as J}from"./index-wocATsGp.js";import{C as Q}from"./data-editor-all-ZqeXZrI7.js";import{E as P,s as U,F as Z,T as ee,M as te}from"./image-window-loader-KuvgVtpW.js";import"./iframe-CHucUuiQ.js";import"../sb-preview/runtime.js";import"./throttle-7EuXLZa7.js";import"./_baseIteratee-WTHxv43n.js";import"./flatten-qRvRBp6y.js";import"./scrolling-data-grid-Lq0bpFDr.js";const re=()=>t=>t.targetX,ie=()=>t=>t.targetY,se=()=>t=>t.targetWidth,ne=()=>t=>t.targetHeight,oe=()=>t=>t.targetY+10,ae=()=>t=>Math.max(0,(t.targetHeight-28)/2),le=$("div")({name:"DataGridOverlayEditorStyle",class:"d16c1ze1",propsAsIs:!1,vars:{"d16c1ze1-0":[ie(),"px"],"d16c1ze1-1":[re(),"px"],"d16c1ze1-2":[se(),"px"],"d16c1ze1-3":[ne(),"px"],"d16c1ze1-4":[oe(),"px"],"d16c1ze1-5":[ae(),"px"]}});function ce(){const[t,n]=i.useState();return[t??void 0,n]}function de(){const[t,n]=ce(),[s,y]=i.useState(0),[p,C]=i.useState(!0);i.useLayoutEffect(()=>{if(t===void 0||!("IntersectionObserver"in window))return;const o=new IntersectionObserver(a=>{a.length!==0&&C(a[0].isIntersecting)},{threshold:1});return o.observe(t),()=>o.disconnect()},[t]),i.useEffect(()=>{if(p||t===void 0)return;let o;const a=()=>{const{right:O}=t.getBoundingClientRect();y(m=>Math.min(m+window.innerWidth-O-10,0)),o=requestAnimationFrame(a)};return o=requestAnimationFrame(a),()=>{o!==void 0&&cancelAnimationFrame(o)}},[t,p]);const S=i.useMemo(()=>({transform:`translateX(${s}px)`}),[s]);return{ref:n,style:S}}const Ce=t=>{const{target:n,content:s,onFinishEditing:y,forceEditMode:p,initialValue:C,imageEditorOverride:S,markdownDivCreateNode:o,highlight:a,className:O,theme:m,id:X,cell:k,bloom:u,validateCell:l,getCellRenderer:w,provideEditor:v,isOutsideClick:A}=t,[c,N]=i.useState(p?s:void 0),R=i.useRef(c??s);R.current=c??s;const[E,I]=i.useState(()=>l===void 0?!0:!(P(s)&&(l==null?void 0:l(k,s,R.current))===!1)),f=i.useCallback((e,r)=>{y(E?e:void 0,r)},[E,y]),V=i.useCallback(e=>{if(l!==void 0&&e!==void 0&&P(e)){const r=l(k,e,R.current);r===!1?I(!1):(typeof r=="object"&&(e=r),I(!0))}N(e)},[k,l]),x=i.useRef(!1),g=i.useRef(void 0),W=i.useCallback(()=>{f(c,[0,0]),x.current=!0},[c,f]),Y=i.useCallback((e,r)=>{f(e,r??g.current??[0,0]),x.current=!0},[f]),K=i.useCallback(async e=>{let r=!1;e.key==="Escape"?(e.stopPropagation(),e.preventDefault(),g.current=[0,0]):e.key==="Enter"&&!e.shiftKey?(e.stopPropagation(),e.preventDefault(),g.current=[0,1],r=!0):e.key==="Tab"&&(e.stopPropagation(),e.preventDefault(),g.current=[e.shiftKey?-1:1,0],r=!0),window.setTimeout(()=>{!x.current&&g.current!==void 0&&(f(r?c:void 0,g.current),x.current=!0)},0)},[f,c]),D=c??s,[d,q]=i.useMemo(()=>{var r,H;if(U(s))return[];const e=v==null?void 0:v(s);return e!==void 0?[e,!1]:[(H=(r=w(s))==null?void 0:r.provideEditor)==null?void 0:H.call(r,s),!1]},[s,w,v]),{ref:B,style:L}=de();let z=!0,M,_=!0,b;if(d!==void 0){z=d.disablePadding!==!0,_=d.disableStyling!==!0;const e=Z(d);e&&(b=d.styleOverride);const r=e?d.editor:d;M=h(r,{isHighlighted:a,onChange:V,value:D,initialValue:C,onFinishedEditing:Y,validatedSelection:P(D)?D.selectionRange:void 0,forceEditMode:p,target:n,imageEditorOverride:S,markdownDivCreateNode:o,isValid:E,theme:m})}b={...b,...L};const T=document.getElementById("portal");if(T===null)return console.error('Cannot open Data Grid overlay editor, because portal not found.  Please add `<div id="portal" />` as the last child of your `<body>`.'),null;let F=_?"gdg-style":"gdg-unstyle";E||(F+=" gdg-invalid"),z&&(F+=" gdg-pad");const j=(u==null?void 0:u[0])??1,G=(u==null?void 0:u[1])??1;return J.createPortal(h(ee.Provider,{value:m,children:h(Q,{style:te(m),className:O,onClickOutside:W,isOutsideClick:A,children:h(le,{ref:B,id:X,className:F,style:b,as:q===!0?"label":void 0,targetX:n.x-j,targetY:n.y-G,targetWidth:n.width+j*2,targetHeight:n.height+G*2,children:h("div",{className:"gdg-clip-region",onKeyDown:K,children:M})})})}),T)};export{Ce as default};
